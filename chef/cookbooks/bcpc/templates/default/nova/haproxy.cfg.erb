###############################################################################
#                            generated by chef
###############################################################################

listen nova-api
  bind <%= @vip %>:8774 ssl crt /etc/haproxy/haproxy.pem
  balance source
  option tcpka
  option httpchk GET /healthcheck
  option httplog
  option forwardfor
<% @headnodes.each do |n| -%>
  server <%= n['hostname'] %> <%= n['service_ip'] %>:8774 check inter 5s rise 1 fall 1
<% end -%>

<%= render 'haproxy/haproxy.cfg.qos.erb', :option => {} %>

listen novncproxy
  bind <%= @vip %>:6080 ssl crt /etc/haproxy/haproxy.pem
  balance source
  option tcpka
  option httplog
  option forwardfor
<% @headnodes.each do |n| -%>
  server <%= n['hostname'] %> <%= n['service_ip'] %>:6080 check inter 5s rise 1 fall 1
<% end -%>

<%= render 'haproxy/haproxy.cfg.qos.erb', :option => {} %>

listen placement-api
  bind <%= @vip %>:8778 ssl crt /etc/haproxy/haproxy.pem
  balance source
  option httplog
  option forwardfor
  option httpchk GET /
  http-check expect status 200
<% @headnodes.each do |n| -%>
  server <%= n['hostname'] %> <%= n['service_ip'] %>:8778 check inter 5s rise 1 fall 1
<% end -%>

<%= render 'haproxy/haproxy.cfg.qos.erb', :option => {} %>
